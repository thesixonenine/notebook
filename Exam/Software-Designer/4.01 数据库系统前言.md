提要

- 数据库模式
- ER模型
- 关系代数与元组演算(重点)
- 规范化理论(重点)
- 并发控制
- 数据库完整性约束
- 分布式数据库
- 数据仓库与数据挖掘


### 三级模式 - 两级映射(选择题)
![](4.01%20数据库系统前言/1.png)


### 数据库的设计过程
![](4.01%20数据库系统前言/2.png)

### 关系代数

- 并
- 交
- 差
- 笛卡尔积
- 投影
- 选择
- 联接

### 规范化理论

### 函数依赖

### 求候选键
从入度为0的节点开始, 能够遍历所有节点, 则该节点为候选关键字/候选码
如果没有入度为0的, 则需要将中间节点(有入度,也有出度)并入入度为0的属性集中, 直到能遍历所有节点

例1. 给定关系R(A, B, C, D)上的函数依赖集F={A->B, C->B, B->C, B->D}, 求R的候选关键字
答案: A
解析: 从A出发, A->B->C, A->B->D, 这样可以遍历所有.

例2. 关系模式P(A,B,C,D,E,F,G,H,I,J)满足下列函数依赖:FD={ABD->E,AB->G.B->F.C->J.CJ->I,G->H},求候选吗
答案: ABCD
解析: 只有ABCD的组合节点才能遍历所有.

例3. 关系R(A, B, C)满足下列函数依赖:F={B->C,B->A,A->BC}, 关系R的候选关键字为?
A. AB    B. A和B    C.A和BC    D.AC和AB
答案: A和B
解析: 只有A或者B能够遍历所有, 所以关键字有两个, A和B.

### 范式(必考)

1NF: 每列都是不可再分的原子单元
2NF: 每列都和主键相关, 而不能只与主键的某一部分相关(联合主键)
3NF: 每列都和主键列直接相关, 而不是间接相关, 即限制列的冗余性

### 并发控制

#### 事务: 多个操作合并在一起成为一个原子操作
- 原子性: 操作不可拆分
- 一致性: 操作前后, 数据一致. 例如转账操作, 转账前后两个账户总额不变
- 隔离性: 多个事务之间互不影响
- 持续性: 事务执行后, 结果持久化

问题:

丢失更新

不可重复读

脏读


#### 封锁协议

- 一级封锁协议. 事务 T 在修改数据 R 之前必须先对其加 X 锁, 直到事务结束才释放, 可防止丢失修改
- 二级封锁协议. 一级封锁协议加上事务 T 在读取数据 R 之前先对其加 S 锁, 读完后即可释放 S 锁. 可防止丢失修改, 还可以防止脏读
- 三级封锁协议. 一级封锁协议加上事务 T 在读取数据 R 之前先对其加 S 锁, 直到事务结束才释放, 可防止丢失修改, 防止脏读与防止数据重复读.
- 两段锁协议. 可串行化的, 可能发生死锁


#### 完整性约束

目的: 提高数据的可靠性, 如果数据不正确就不能插入

- 实体完整性约束(定义主键,非空不重复)
- 参照完整性约束(定义外键, 比如学生表中的班级号是参照班级表的主键,要求插入学生表的班级号必须是班级表的主键(可空))
- 用户自定义完整性约束(比如, 只允许正数)


**触发器**: 用脚本来约束更复杂的场景

### 数据库安全

| 措施      | 说明                                           |
|---------|----------------------------------------------|
| 用户标识和鉴定 | **认证**最外层的措施, 使用账户,口令及随机数检验等方式               |
| 存取控制    | **授权**对用户的进行授权, 操作类型(查找,插入,删除,修改)和数据对象(数据范围) |
| 密码存储和传输 | 对远程终端信息用密码传输                                 |
| 视图的保护   | 对视图进行授权                                      |
| 审计      | 使用专门的数据库,自动记录用户对数据库的所有操作                     |


### 数据备份与恢复(重点)

#### 数据备份

- 冷备份
- 热备份

**冷备份**

在数据库关闭停止状态下, 直接复制文件

- 优点: 快速,易归档,易恢复
- 缺点: 只能提供某一时间点的恢复, 备份时不能做其他工作, 磁盘空间要求大, 不能按表或用户来恢复

**热备份**

在数据库正常运行时, 利用备份软件, 将数据库中的数据文件复制出来

- 优点: 可在表空间或数据库文件级备份, 备份时间短, 备份时数据库仍然可用, 可达秒级恢复, 恢复是快速的
- 缺点: 不能出错, 若热备份不成功, 所得结果不可用于时间点的恢复; 维护困难


- 完全备份: 备份所有数据
- 差量备份: 仅备份上一次完全备份之后变化的数据
- 增量备份: 备份上一次备份之后变化的数据

#### 数据库故障与恢复

| 故障关系        | 故障原因         | 解决方法                                    |
|-------------|--------------|-----------------------------------------|
| 事务本身的可预期故障  | 本身逻辑         | 设置rollback                              |
| 事务本身的不可预期故障 | 算术溢出, 违法存储保护 | 由DBMS的恢复子系统通过日志, 撤销事务对数据库的修改, 回退到事务初始状态 |
| 系统故障        | 系统停止         | 检查点法                                    |
| 介质故障        | 磁盘破坏         | 使用日志重做业务                                |


### 数据仓库与数据挖掘(BI)


### 反规范化

规划化会导致查询效率降低, 查询需要连过多的表, 解决办法就是空间换时间

- 增加派生性冗余列: 购物车表, 原来只有单价和数量, 现在冗余总价, 就可以不必每次计算总价
- 增加冗余列 
- 重新组表
- 分割表: 垂直分割,水平分割
